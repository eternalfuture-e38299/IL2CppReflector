# IL2CppReflector

> üîç –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–∞ C++ –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä IL2CPP –≤ –∏–≥—Ä–∞—Ö, –≤–∫–ª—é—á–∞—è –∫–ª–∞—Å—Å—ã, –º–µ—Ç–æ–¥—ã, –ø–æ–ª—è, —Ç–∏–ø—ã –∏ –¥—Ä—É–≥–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã.

## üìå –í–≤–µ–¥–µ–Ω–∏–µ

**IL2CppReflector** ‚Äî —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞ C++, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö IL2CPP, –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –∏–∑ –∏–≥—Ä –Ω–∞ Unity. –û–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–π –∏ –º–æ–¥—É–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –≤ IL2CPP —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤, –ø–æ–ª—è, —Å–≤–æ–π—Å—Ç–≤–∞ –∏ –º–µ—Ç–æ–¥—ã.

* –ü—Ä–æ–µ–∫—Ç –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, —Ä–µ–≤–µ—Ä—Å-–∏–Ω–∂–µ–Ω–µ—Ä–æ–≤ –∏–ª–∏ –∞–≤—Ç–æ—Ä–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–ª–∏ –¥–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏ IL2CPP.

## üß∞ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–µ—Ä—Å–∏–π Unity
- –ú–æ–¥—É–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ IL2CPP: –∫–ª–∞—Å—Å—ã, –º–µ—Ç–æ–¥—ã, –ø–æ–ª—è, —Å–≤–æ–π—Å—Ç–≤–∞ –∏ —Ç.–¥.
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ UTF-8)
- –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —Å–±–æ—Ä–∫–∏ CMake
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ö—É–∫–æ–≤ –∏ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```cpp
#include <spdlog/spdlog.h>

IL2CppReflector::Logger::SetOutputFunction([](const IL2CppReflector::Logger::Record &record) -> void {
switch (record.level) {
case IL2CppReflector::Logger::Level::Trace:
spdlog::trace("[{}:{} ({})] {}", record.sourceFile, record.sourceLine, record.sourceFunction, record.message);
break;
case IL2CppReflector::Logger::Level::Debug:
spdlog::debug("[{}:{} ({})] {}", record.sourceFile, record.sourceLine, record.sourceFunction, record.message);
break;
// ...–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä—É–≥–∏—Ö —É—Ä–æ–≤–Ω–µ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
}
});
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö—É–∫–æ–≤

```cpp
#include <dobby.h>

IL2CppReflector::HookWrapper::SetHookFun(
[](const IL2CppReflector::HookWrapper::Info& info) -> bool {
return !DobbyHook(info.address, info.replace_func, info.origin_func);
},
[](void* address) -> bool {
return !DobbyDestroy(address);
});
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Ñ–ª–µ–∫—Ç–æ—Ä–∞

```cpp
void* handle = ... // –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –º–æ–¥—É–ª—å il2cpp
IL2CppReflector::init_from_handle(handle);
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏

```cpp
/**
* –ö–æ–¥, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π API IL2CppReflector, –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ –∫–æ–ª–±—ç–∫–∞
* –∏–ª–∏ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ il2cpp_init, –∏–Ω–∞—á–µ –æ–Ω –±—É–¥–µ—Ç –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
**/
IL2CppReflector::AddOnLoadedEvent([]() -> void {
// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞—Å—Å–µ –∏ –º–µ—Ç–æ–¥–µ
auto targetClass = IL2CppReflector::Class("NamespaceA", "ClassA",
IL2CppReflector::GetImage("Assembly-CSharp.dll"));

auto targetMethod = targetClass.GetMethod("MethodA");

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ö—É–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ –º–µ—Ç–æ–¥
void* originalMethod;
DobbyHook(targetMethod.GetMethodPointer(),
(void*)hookFunction, &originalMethod);
});
```

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–±–æ—Ä–∫–µ

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π C++17
- [CMake](https://cmake.org/) (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è 3.10 –∏ –≤—ã—à–µ)